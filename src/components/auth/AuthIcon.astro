---
import LoadingSpinner from "./LoadingSpinner.astro";
---

<div id="auth-container" class="ml-5">
	<button
		id="auth-icon-button"
		aria-label="Sign In"
		class="hover:text-accent relative h-9 w-9 cursor-pointer rounded-md py-2 mt-1" type="button"
	>
		<span class="inline-block size-4">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="1.5"
				stroke-linecap="round"
				stroke-linejoin="round"
				class="lucide lucide-circle-user-round-icon lucide-circle-user-round size-full scale-180 transform"
				><path d="M18 20a6 6 0 0 0-12 0"></path><circle cx="12" cy="10" r="4"></circle><circle
					cx="12"
					cy="12"
					r="10"></circle></svg
			>
		</span>
	</button>
	<div class="flex items-center justify-center">
		<LoadingSpinner />
	</div>
</div>

<script>
	import authStore from "@/utils/authStore";
	import type { Session } from "@supabase/supabase-js";

	const authIconButton = document.getElementById("auth-icon-button");
	const authModal = document.getElementById("auth-modal");
	const loadingSpinner = document.getElementById("loading-spinner");

	function handleLoadingState(_session: Session | null, loading: boolean) {
		if (loading) {
			authIconButton?.classList.add("hidden");
			loadingSpinner?.classList.remove("hidden");
		} else {
			authIconButton?.classList.remove("hidden");
			loadingSpinner?.classList.add("hidden");
		}
	}

	authStore.subscribe(handleLoadingState);

	authIconButton?.addEventListener("click", () => {
		authModal?.classList.remove("hidden");
	});
</script>
